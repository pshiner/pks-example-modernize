DROP TABLE IF EXISTS DATABASECHANGELOG;
DROP TABLE IF EXISTS DATABASECHANGELOGLOCK;

DROP TABLE IF EXISTS EX_PERIODIC_PAYMENT;
DROP TABLE IF EXISTS EX_LOAN;
DROP TABLE IF EXISTS EX_BORROWER;
DROP TABLE IF EXISTS EX_APP_USER;
DROP TABLE IF EXISTS EX_PROGRAM;

/*
 * The assumed primary key is C_CODE.
 */

CREATE TABLE EX_PROGRAM (
    C_CODE			VARCHAR(16) NOT NULL,
	C_NAME			VARCHAR(64) NOT NULL,
	C_DESCRIPTION	VARCHAR(512),
	CONSTRAINT EX_PROGRAM_PK PRIMARY KEY (C_CODE)
);

INSERT INTO EX_PROGRAM (C_CODE, C_NAME, C_DESCRIPTION) VALUES
	('AAA',   'My first loan program',  'This is the first.'                   ),
	('AAB',   'My second loan program', 'This is the second of a few programs.'),
	('CAAXW', 'My third loan program',  'This is number 3 program.'            );

CREATE TABLE EX_BORROWER (
	FK_PROGRAM_CODE		VARCHAR(16) NOT NULL,
	C_CODE				VARCHAR(16) NOT NULL,
	C_NAME				VARCHAR(64) NOT NULL,
	C_PHONE				VARCHAR(16),
	C_ORGANIZATION		VARCHAR(64),
	CONSTRAINT EX_BORROWER_PK PRIMARY KEY (FK_PROGRAM_CODE,C_CODE),
	CONSTRAINT EX_BORROWER_CODE_UC UNIQUE (C_CODE)
);

INSERT INTO EX_BORROWER (FK_PROGRAM_CODE,C_CODE,C_NAME,C_PHONE,C_ORGANIZATION) VALUES
	('AAA', 'B001', 'Peter', '17049067258', 'MetaPhase Consulting'),
	('AAA', 'B002', 'Martin', NULL,         'MetaPhase Consulting'),
	('AAA', 'B003', 'Steve',  NULL,         'MetaPhase Consulting'),
	('AAA', 'B004', 'Elliot', NULL,         'MetaPhase Consulting');

CREATE TABLE EX_APP_USER (
	C_USERNAME	VARCHAR(16) NOT NULL,
	C_NAME		VARCHAR(64) NOT NULL,
	CONSTRAINT EX_APP_USER_PK PRIMARY KEY (C_USERNAME)
);

INSERT INTO EX_APP_USER (C_USERNAME,C_NAME) VALUES
   ('peter',  'Peter' ),
   ('martin', 'Martin');

/*
 * The assumed primary key is FK_PROGRAM_CODE, N_LOAN_NUMBER.
 */
CREATE TABLE EX_LOAN (
	FK_BORROWER_CODE		VARCHAR(16) NOT NULL,
	C_CODE					VARCHAR(16) NOT NULL,
	N_LOAN_NUMBER			INTEGER     NOT NULL,
	C_STATUS				VARCHAR(1)  NOT NULL DEFAULT 'D',
	C_NAME					VARCHAR(64) NOT NULL,
	C_DESCRIPTION			VARCHAR(512),
	BD_INTEREST_RATE		NUMERIC(6,4),
	BD_ORIGINAL_PRINCIPAL	NUMERIC(14,2),
	FK_APP_USER				VARCHAR(16) NOT NULL,
	CONSTRAINT EX_LOAN_PK PRIMARY KEY(FK_BORROWER_CODE,C_CODE),
	CONSTRAINT EX_LOAN_CODE_UC UNIQUE (C_CODE)
);

INSERT INTO EX_LOAN (FK_BORROWER_CODE, C_CODE, N_LOAN_NUMBER, C_STATUS, C_NAME, 
		C_DESCRIPTION, BD_INTEREST_RATE, BD_ORIGINAL_PRINCIPAL, FK_APP_USER) VALUES
	('B002', 'XYZ-1', 1, 'D', 'Boat',       'Going to buy a boat.',       3.75,   15500,  'peter' ),
	('B002', 'XYZ-2', 2, 'D', 'House',      'Going to buy a house.',      3.5575, 554300, 'peter' ),
	('B002', 'ABC-3', 3, 'D', 'Truck',      'Going to buy a truck.',      4.875,  15500,  'martin'),
	('B002', 'XYZ-4', 4, 'D', 'Motorcycle', 'Going to buy a motorcycle.', 2.75,   15500,  'martin'),
	('B002', 'ZZZ-5', 5, 'D', 'Plane',      'Going to buy a plane.',      8.75,   675500, 'peter' );

/*
 * The assumed primary key is FK_PROGRAM_CODE, FK_LOAN_NUMBER, N_PMT_SEQUENCE.
 */
CREATE TABLE EX_PERIODIC_PAYMENT (
	FK_BORROWER_CODE		VARCHAR(16) NOT NULL,
	FK_LOAN_CODE			VARCHAR(16) NOT NULL,
	N_PMT_SEQUENCE			INTEGER NOT NULL,
	D_PMT_DATE				DATE NOT NULL,
	D_PMT_ADJUSTED_DATE		DATE,
	BD_PMT_PRINCIPAL		NUMERIC(14,2),
	BD_PMT_INTEREST			NUMERIC(14,2),
	BD_PMT_CAP_INTEREST		NUMERIC(14,2),
	BD_BAL_PRINCIPAL		NUMERIC(14,2),
	BD_BAL_CAP_INTEREST		NUMERIC(14,2),
	CONSTRAINT EX_PERIODIC_PAYMENT_PK PRIMARY KEY (FK_BORROWER_CODE,FK_LOAN_CODE,N_PMT_SEQUENCE),
	CONSTRAINT EX_PERIODIC_PAYMENT_PMT_SEQUENCE_UC UNIQUE(N_PMT_SEQUENCE)
);

INSERT INTO EX_PERIODIC_PAYMENT (
	FK_BORROWER_CODE, FK_LOAN_CODE, N_PMT_SEQUENCE, D_PMT_DATE, D_PMT_ADJUSTED_DATE,
	BD_PMT_PRINCIPAL, BD_PMT_INTEREST, BD_PMT_CAP_INTEREST, BD_BAL_PRINCIPAL, BD_BAL_CAP_INTEREST) VALUES
	('B002', 'XYZ-2',  1, '2024-08-05', '2024-08-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2',  2, '2024-09-05', '2024-09-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2',  3, '2024-10-05', '2024-10-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2',  4, '2024-11-05', '2024-11-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2',  5, '2024-12-05', '2024-12-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2',  6, '2025-01-05', '2025-01-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2',  7, '2025-02-05', '2025-02-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2',  8, '2025-03-05', '2025-03-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2',  9, '2025-04-05', '2025-04-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2', 10, '2025-05-05', '2025-05-05', 325, 645, 0, 15450, 0 ),
	('B002', 'XYZ-2', 11, '2025-06-05', '2025-06-05', 325, 645, 0, 15450, 0 );